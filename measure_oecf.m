clearvars;
addpath('load','lf','render');

[im, model] = read_lfp('../../images/lytro/oecf/00011');
lf = extract_lf(im, model);
% im = FSR_compute(FSR_preprocess(uint16(lf * 65535)), 0);
im = render_shift(lf, 1);

in_values = [0 0.06 0.13 0.21 0.28 0.35 0.45 0.54 0.63 0.78 0.88 1.02 1.20 1.37 1.55 1.79 2.19 2.35 3.21 4.18];
n = numel(in_values);

in_values = 10.^(-in_values);

% coordinates for img00011.lfp
coord = [270 170;...
		 270 145;...
		 265 197;...
		 265 120;...
		 245 225;...
		 245 90;...
		 215 245;...
		 215 75;...
		 185 247;...
		 185 70;...
		 155 250;...
		 150 70;...
		 123 242;...
		 120 75;...
		 90 228;...
		 90 90;...
		 70 200;...
		 70 120;...
		 65 174;...
		 65 145];
rect_size = [20 20];

im = im / max(im(:));

out_values = zeros(1,n);
for i = 1:size(coord,1)
	patch = imcrop(im, [coord(i,2) coord(i,1) rect_size]);
	out_values(n-i+1) = sum(patch(:)) / numel(patch)
end

save('oecf.mat','in_values','out_values');
